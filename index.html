// Highly advanced version of cryptocurrency-based loot box and mini-games with animations and integrated images

// Required libraries
const express = require('express');
const path = require('path');
const bodyParser = require('body-parser');
const Web3 = require('web3');
const { randomInt } = require('crypto');
const fs = require('fs');

const app = express();
const port = 3000;

// Blockchain configuration (e.g., Solana RPC endpoints)
const web3 = new Web3('https://api.mainnet-beta.solana.com');

// Middleware
app.use(bodyParser.json());
app.use('/static', express.static(path.join(__dirname, 'static')));
app.use('/images', express.static(path.join(__dirname, 'images')));

// Data
const rewardPool = [
    { type: 'solana', amount: randomInt(1, 10) },
    { type: 'nft', id: `NFT-${randomInt(1000, 9999)}` },
    { type: 'bonus-game', game: 'dice-game' },
    { type: 'bonus-game', game: 'spin-wheel' },
    { type: 'rare-item', item: 'Golden Loot Chest' },
    { type: 'nothing', message: 'Better luck next time!' }
];

// Routes
app.get('/', (req, res) => {
    res.sendFile(path.join(__dirname, 'views/index.html'));
});

// API endpoint for loot box opening
app.post('/open-loot-box', async (req, res) => {
    const reward = rewardPool[randomInt(0, rewardPool.length)];
    res.json({ success: true, reward });
});

// API endpoint for dice game
app.post('/roll-dice', async (req, res) => {
    const roll = randomInt(1, 7);
    const reward = roll > 4 ? { success: true, reward: roll * 0.2, message: 'You won SOL!' } : { success: false, message: 'Try again!' };
    res.json(reward);
});

// API endpoint for spinning wheel
app.post('/spin-wheel', async (req, res) => {
    const outcomes = [
        { prize: '1 SOL' },
        { prize: '2 SOL' },
        { prize: 'NFT' },
        { prize: 'No prize, try again' },
        { prize: 'Golden Loot Chest' }
    ];
    const result = outcomes[randomInt(0, outcomes.length)];
    res.json({ success: true, result });
});

// Extended static resources
const lootBoxHTML = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LootSol: Complex Gaming Experience</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script src="/static/animations.js" defer></script>
</head>
<body>
    <header>
        <h1>LootSol: Explore the Blockchain Magic</h1>
    </header>
    <main id="game-container">
        <section id="loot-box-section">
            <h2>Open Your Magical Loot Box</h2>
            <img src="/images/loot-box.png" alt="Loot Box" class="animated-box">
            <button id="open-loot" class="action-button">Open Loot Box</button>
        </section>

        <section id="mini-games-section">
            <h2>Play Mini Games</h2>
            <div class="game-buttons">
                <button id="play-dice" class="action-button">Dice Game</button>
                <button id="spin-wheel" class="action-button">Spin the Wheel</button>
                <button id="treasure-hunt" class="action-button">Treasure Hunt</button>
            </div>
        </section>

        <section id="result-display">
            <h2>Game Results</h2>
            <div id="result-output"></div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 LootSol. All Rights Reserved.</p>
    </footer>

    <script>
        const displayResult = (result) => {
            const output = document.getElementById('result-output');
            output.innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
        };

        document.getElementById('open-loot').addEventListener('click', async () => {
            const response = await fetch('/open-loot-box', { method: 'POST' });
            const data = await response.json();
            displayResult(data.reward);
        });

        document.getElementById('play-dice').addEventListener('click', async () => {
            const response = await fetch('/roll-dice', { method: 'POST' });
            const data = await response.json();
            displayResult(data);
        });

        document.getElementById('spin-wheel').addEventListener('click', async () => {
            const response = await fetch('/spin-wheel', { method: 'POST' });
            const data = await response.json();
            displayResult(data.result);
        });

        document.getElementById('treasure-hunt').addEventListener('click', () => {
            const treasureAnimation = document.createElement('div');
            treasureAnimation.className = 'treasure-animation';
            treasureAnimation.innerText = 'Treasure Hunt Starting...';
            document.body.appendChild(treasureAnimation);
            setTimeout(() => {
                treasureAnimation.remove();
                displayResult({ message: 'You discovered a hidden treasure!' });
            }, 3000);
        });
    </script>
</body>
</html>
`;

fs.writeFileSync(path.join(__dirname, 'views/index.html'), lootBoxHTML);

// Launch server
app.listen(port, () => {
    console.log(`LootSol complex game server running on http://localhost:${port}`);
});

/* Enhancements:
 * - Added "Treasure Hunt" mini-game with animations
 * - Integrated image assets for all sections
 * - Dynamic animations for treasure discovery
 * - Advanced reward logic with rare items
 * - Extended UI for multiple games
 */
