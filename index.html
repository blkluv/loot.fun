// Main file for a cryptocurrency-based loot box and dice game

// Required libraries
const express = require('express');
const path = require('path');
const Web3 = require('web3');
const { randomInt } = require('crypto');

const app = express();
const port = 3000;

// Blockchain configuration (e.g., Solana RPC endpoints)
const web3 = new Web3('https://api.mainnet-beta.solana.com');

// Serve static files
app.use('/static', express.static(path.join(__dirname, 'static')));

// Routes
app.get('/', (req, res) => {
    res.sendFile(path.join(__dirname, 'views/index.html'));
});

// API endpoint for loot box opening
app.post('/open-loot-box', async (req, res) => {
    const rewardPool = [
        { type: 'solana', amount: randomInt(1, 5) }, // SOL rewards
        { type: 'nft', id: `NFT-${randomInt(1000, 9999)}` },
        { type: 'nothing', message: 'Better luck next time!' }
    ];

    const reward = rewardPool[randomInt(0, rewardPool.length)];

    res.json({ success: true, reward });
});

// API endpoint for dice game
app.post('/roll-dice', async (req, res) => {
    const roll = randomInt(1, 7); // Simulate dice roll (1-6)

    if (roll > 4) {
        res.json({ success: true, reward: roll * 0.1, message: 'You won SOL!' });
    } else {
        res.json({ success: false, message: 'Try again!' });
    }
});

// Launch server
app.listen(port, () => {
    console.log(`LootSol game server running on http://localhost:${port}`);
});

/* Next steps:
 * - Integrate animations and front-end with assets provided
 * - Configure smart contract interaction for payouts
 * - Deploy to a live server
 */
